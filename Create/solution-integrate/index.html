<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Create/solution-integrate">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Integrate | IBM Client Engineering</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ibm-client-engineering.github.io/solution-sfg-aws/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ibm-client-engineering.github.io/solution-sfg-aws/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ibm-client-engineering.github.io/solution-sfg-aws/Create/solution-integrate"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="ibm client engineering, open solutions library,  sfg, eks, aws, cp4ba, sfg on aws eks"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Integrate | IBM Client Engineering"><meta data-rh="true" name="description" content="Task Overview"><meta data-rh="true" property="og:description" content="Task Overview"><link data-rh="true" rel="icon" href="/solution-sfg-aws/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ibm-client-engineering.github.io/solution-sfg-aws/Create/solution-integrate"><link data-rh="true" rel="alternate" href="https://ibm-client-engineering.github.io/solution-sfg-aws/Create/solution-integrate" hreflang="en"><link data-rh="true" rel="alternate" href="https://ibm-client-engineering.github.io/solution-sfg-aws/Create/solution-integrate" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/solution-sfg-aws/blog/rss.xml" title="IBM Client Engineering RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/solution-sfg-aws/blog/atom.xml" title="IBM Client Engineering Atom Feed">






<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GB0XWXF3GE"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GB0XWXF3GE",{anonymize_ip:!0})</script><link rel="stylesheet" href="/solution-sfg-aws/assets/css/styles.c09cc6e1.css">
<link rel="preload" href="/solution-sfg-aws/assets/js/runtime~main.bb3352e2.js" as="script">
<link rel="preload" href="/solution-sfg-aws/assets/js/main.8093d258.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/solution-sfg-aws/"><div class="navbar__logo"><img src="/solution-sfg-aws/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA" height="200" width="200"><img src="/solution-sfg-aws/img/logo-dark.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="200" width="200"></div><b class="navbar__title text--truncate">| IBM Sterling File Gateway on AWS EKS</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/solution-sfg-aws/">Adoption Journey</a><a class="navbar__item navbar__link" href="/solution-sfg-aws/blog">Flight Logs</a><a href="https://github.com/ibm-client-engineering/solution-sfg-aws" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/solution-sfg-aws/">Adoption Journey</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/solution-sfg-aws/category/prepare">Prepare</a><button aria-label="Toggle the collapsible sidebar category &#x27;Prepare&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solution-sfg-aws/Prepare/learn">Learn</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solution-sfg-aws/Prepare/stage">Stage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/solution-sfg-aws/category/create">Create</a><button aria-label="Toggle the collapsible sidebar category &#x27;Create&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solution-sfg-aws/Create/solution-deploy">Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/solution-sfg-aws/Create/solution-validate">Validate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/solution-sfg-aws/Create/solution-integrate">Integrate</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/solution-sfg-aws/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/solution-sfg-aws/category/create"><span itemprop="name">Create</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Integrate</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Enabling S3 Bucket access</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-overview">Task Overview<a href="#task-overview" class="hash-link" aria-label="Direct link to Task Overview" title="Direct link to Task Overview">​</a></h2><p>Per the IBM Documentation, the following steps would need to be performed in order to allow for S3 bucket access:</p><p>Installing AWS SDK for Java on B2BI Certified Container/Docker deployment:</p><ol><li>On B2BI Dashboard, select Customization &gt; Customization. Click the Click Here To Access link. In the Customization login screen, enter the User Name and Password and click Login. (apiadmin/apipassword)</li><li>Click Custom Jar. The Custom Jar list page is displayed.
Click Create CustomJar.</li><li>Set the &#x27;Vendor Name&#x27; as &quot;awssdk&quot;. &#x27;Vendor Version&#x27; as the version from &quot;aws-java-sdk-<!-- -->[version]<!-- -->&quot; you downloaded earlier.</li><li>Set the &#x27;File Type&#x27; as &quot;LIBRARY&quot;. Set &#x27;Target Path&#x27; as &quot;Every&quot;.</li><li>Upload the files mentioned below (Create multiple custom jars using same parameters as mentioned in ibm-client-engineering/spog-fsm-st5#4 and ibm-client-engineering/spog-fsm-st5#5 above along with each file mentioned below):<ol><li>aws-java-sdk-<!-- -->[version]<!-- -->.jar (Found in aws-java-sdk-<!-- -->[version]<!-- -->/lib)</li><li>httpclient-<!-- -->[version]<!-- -->.jar</li><li>httpcore-<!-- -->[version]<!-- -->.jar</li><li>jackson-annotations-<!-- -->[version]<!-- -->.jar</li><li>jackson-core-<!-- -->[version]<!-- -->.jar</li><li>jackson-databind-<!-- -->[version]<!-- -->.jar</li><li>joda-time-<!-- -->[version]<!-- -->.jar</li><li>netty-*.jar (Found in aws-java-sdk-<!-- -->[version]<!-- -->/third-party/lib)</li></ol></li></ol><p>Restart the ASI/AC/API pods.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="task-breakdown">Task Breakdown<a href="#task-breakdown" class="hash-link" aria-label="Direct link to Task Breakdown" title="Direct link to Task Breakdown">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-apiadmin-user">Creating an <code>apiadmin</code> user<a href="#creating-an-apiadmin-user" class="hash-link" aria-label="Direct link to creating-an-apiadmin-user" title="Direct link to creating-an-apiadmin-user">​</a></h3><p>Login to our dashboard URL:</p><p><a href="https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/dashboard/" target="_blank" rel="noopener noreferrer">https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/dashboard/</a></p><ol><li>Select Accounts-&gt;User Accounts</li></ol><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/53dbc727-b0fa-4a6b-b514-61421a88eae1" alt="apiadmin_create_01|300" class="img_ev3q"></p><ol start="2"><li>Set the username to <code>apiadmin</code> with a password of <code>apipassword</code></li></ol><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/281121e5-0358-4a47-9a6a-2de6e4f65e8c" alt="apiadmin_create_02|300" class="img_ev3q"></p><ol start="3"><li>Skip SSH Authorized Keys as we do not require this for this account</li></ol><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/09287bb6-2f43-462f-92ce-8dccce62b39f" alt="apiadmin_create_03|300" class="img_ev3q"></p><ol start="4"><li>Under <code>Filter Data</code> search for <code>Sterling</code>, then Select <code>Sterling B2B Integrator Admin</code> and assign it. Then press <code>Next</code></li></ol><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/1e52ec87-11e4-48ae-88fb-af7a1fbc1b15" alt="apiadmin_create_04a|150" class="img_ev3q"></td><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/73b5ac62-2778-4975-9ab8-ce182a51f690" alt="apiadmin_create_04b|150" class="img_ev3q"></td></tr></tbody></table><ol start="5"><li>Permissions - Under <code>Filter Data</code> search for <code>APIUser</code>. Select <code>APIUser</code> and add it to the permissions below with the arrow. Then hit <code>Next</code>.</li></ol><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/9279d0e8-d713-476d-9c68-7a87f7cc7fe0" alt="apiadmin_create_05a|150" class="img_ev3q"></td><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/b21115d7-a14e-4448-b655-9d0381b89a87" alt="apiadmin_create_05b|150" class="img_ev3q"></td></tr></tbody></table><ol start="6"><li>User Information - Set the <code>Given Name</code> and <code>Surname</code> to <code>api</code> and <code>apiadmin</code> respectfully. Then click <code>Next</code>.</li></ol><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/fabef444-8f8c-4740-a98a-8440ce848704" alt="apiadmin_create_06|300" class="img_ev3q"></p><ol start="7"><li>Confirm - Verify all info is correct and then click <code>Finish</code></li></ol><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/57cca0b8-605f-4704-b235-70d43a6a5c06" alt="apiadmin_create_07|300" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uploading-required-jar-files-for-s3-access">Uploading Required Jar files for S3 access<a href="#uploading-required-jar-files-for-s3-access" class="hash-link" aria-label="Direct link to Uploading Required Jar files for S3 access" title="Direct link to Uploading Required Jar files for S3 access">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="downloading-latest-aws-sdk-zip-file">Downloading latest AWS SDK zip file<a href="#downloading-latest-aws-sdk-zip-file" class="hash-link" aria-label="Direct link to Downloading latest AWS SDK zip file" title="Direct link to Downloading latest AWS SDK zip file">​</a></h3><p>Latest SDK can be retrieved here:</p><p><a href="https://sdk-for-java.amazonwebservices.com/latest/aws-java-sdk.zip" target="_blank" rel="noopener noreferrer">https://sdk-for-java.amazonwebservices.com/latest/aws-java-sdk.zip</a></p><p>Download the zip and extract it. The files needed will live at the following paths:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/lib/aws-java-sdk-1.12.464.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/httpclient-4.5.13.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/httpcore-4.4.13.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/jackson-annotations-2.12.7.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/jackson-core-2.12.7.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/jackson-databind-2.12.7.1.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/joda-time-2.8.1.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-buffer-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-codec-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-codec-http-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-common-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-handler-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-resolver-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-transport-4.1.86.Final.jar</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws-java-sdk-1.12.464/third-party/lib/netty-transport-native-unix-common-4.1.86.Final.jar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Versions may be differnt as the <code>aws-java-sdk.zip</code> is always being updated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="propertyui-url">PropertyUI url<a href="#propertyui-url" class="hash-link" aria-label="Direct link to PropertyUI url" title="Direct link to PropertyUI url">​</a></h3><p>Retrieve the propertyUI url. It can be retrieved with the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">echo &quot;https://&quot;$(kubectl get ingress sterling-b2bi-b2bi-ingress -o jsonpath=&#x27;{..hostname}&#x27;)&quot;/propertyUI/app/&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">https://myingress.elb.us-east-1.amazonaws.com/propertyUI/app/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Login using the <code>apiadmin</code> user we created with the password <code>apipassword</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload-each-jar-file">Upload each jar file<a href="#upload-each-jar-file" class="hash-link" aria-label="Direct link to Upload each jar file" title="Direct link to Upload each jar file">​</a></h3><p>Select <code>CustomJar</code> from the top menubar</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/6d410788-68d4-4a1d-a66d-d719b0cf24e8" alt="customjars_01|300" class="img_ev3q"></p><p>Click <code>Create CustomJar</code> from the top of the page</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/cca5de3f-9d01-4bdb-9874-f379f119de27" alt="customjars_02|300" class="img_ev3q"></p><p>In this example we are uploading the latest <code>aws-java-sdk</code> jar file. Click the browse button and select the aws-java-sdk jar file from the path extracted above.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/78111b83-f7c0-4027-ae76-5a086a8f8719" alt="customjars_03|300" class="img_ev3q"></p><p>When complete, click the <code>Save CustomJar</code> button.</p><p>Wash, rinse, repeat with the other jar files in the above list. </p><p>When complete, the page should look <em>similar</em> but not exactly like this:</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/394fa3dd-5ea4-4360-b619-d099009d5c85" alt="customjars_04|300" class="img_ev3q"></p><p>Restart all the pods.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl scale sts sterling-b2bi-b2bi-ac-server --replicas=0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl scale sts sterling-b2bi-b2bi-asi-server --replicas=0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl scale sts sterling-b2bi-b2bi-api-server --replicas=0</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl scale sts sterling-b2bi-b2bi-ac-server --replicas=1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl scale sts sterling-b2bi-b2bi-asi-server --replicas=1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl scale sts sterling-b2bi-b2bi-api-server --replicas=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>You may need to update the startup probe failure threshold for the ASI application in your b2bi overrides file to 12 before restarting the pods after creating the above custom jars.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">  startupProbe:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    initialDelaySeconds: 120</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    timeoutSeconds: 30</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    periodSeconds: 60</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    failureThreshold: 12</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Whenever the pods are restarted, they will go through a copy process to install these custom jars and that adds to the load time. Without this change, the startup probe may wind up killing the ASI pod before this process is complete.</p></div></div><h1>B2Bi Adapter creation and configuration</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-communication-adapters">Configuring communication adapters:<a href="#configuring-communication-adapters" class="hash-link" aria-label="Direct link to Configuring communication adapters:" title="Direct link to Configuring communication adapters:">​</a></h2><p>The following adapters can be used with Sterling File Gateway:</p><table><thead><tr><th align="left">Protocol</th><th align="left">Adapter</th></tr></thead><tbody><tr><td align="left">FTP, FTPS</td><td align="left">FTP Server adapter</td></tr><tr><td align="left">FTP, FTPS</td><td align="left">FTP Client adapter and services</td></tr><tr><td align="left">SSH/SFTP, SSH/SCP</td><td align="left">SFTP Server adapter</td></tr><tr><td align="left">SSH/SFTP</td><td align="left">SFTP Client adapter and services</td></tr><tr><td align="left">Sterling Connect:Direct</td><td align="left">Connect:Direct Server adapter</td></tr><tr><td align="left">PGP</td><td align="left">Command Line Adapter 2</td></tr><tr><td align="left">HTTP, HTTPS, WebDAV (Requires extensibility. See Add Custom Protocols.)</td><td align="left">HTTP Server adapter</td></tr><tr><td align="left">HTTP, HTTPS, WebDAV (Requires extensibility. See Add Custom Protocols.)</td><td align="left">HTTP Client adapter and services</td></tr><tr><td align="left">WebSphere® MQ File Transfer Edition</td><td align="left">WebSphere MQ File Transfer Edition Agent adapter, WebSphere MQ Suite Async adapter, WebSphere MQ File Transfer Edition Create Transfer service, FTP Server Adapter</td></tr></tbody></table><p>Primary URL can be found with the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl get ingress sterling-b2bi-b2bi-ingress -o jsonpath=&quot;{..hostname}&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Login to the dashboard as <code>fg_sysadmin</code>:</p><p><a href="https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/dashboard" target="_blank" rel="noopener noreferrer">https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/dashboard</a></p><p>From the main menu: </p><ol><li>Select Deployment &gt; Services &gt; Configuration.</li><li>Select and configure the adapters you require.</li></ol><p>As an example, let&#x27;s configure SFTP. Per the above table, SFTP is <code>SFTP Client adapter</code></p><p>Log out of dashboard and log back into the <code>filegateway</code> as <code>fg_architect</code>:</p><p><a href="https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/filegateway" target="_blank" rel="noopener noreferrer">https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/filegateway</a></p><p>From the main menu, select <strong>Participants &gt; Communities</strong> to create a community with the following values:</p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td>Community Name</td><td>FirstComm</td></tr><tr><td>Partner Initiates Protocol Connection</td><td>X</td></tr><tr><td>Partner Listens for Protocol Connections</td><td>X</td></tr><tr><td>SSH/SFTP</td><td>X</td></tr><tr><td>Should Receive Notification</td><td>Yes</td></tr></tbody></table><p>Select <strong>Participants &gt; Groups</strong> to create a group named <code>Group1</code>.</p><p>Log out of <code>filegateway</code> and log back in as <code>fg_provisioner</code></p><p>Create two partners with the following values:</p><p>Select <strong>Participants &gt; Partners</strong> </p><table><thead><tr><th>Field</th><th>Value For First Partner</th><th>Value For Second Partner</th></tr></thead><tbody><tr><td>Community</td><td>FirstComm</td><td>FirstComm</td></tr><tr><td>Partner Name</td><td>Partner1</td><td>Partner2</td></tr><tr><td>Phone</td><td>333</td><td>444</td></tr><tr><td>Email</td><td><a href="mailto:y@x.com" target="_blank" rel="noopener noreferrer">y@x.com</a></td><td><a href="mailto:x@y.com" target="_blank" rel="noopener noreferrer">x@y.com</a></td></tr><tr><td>User Name</td><td>partner1</td><td>partner2</td></tr><tr><td>Password</td><td>p@ssw0rd</td><td>p@ssw@rd</td></tr><tr><td>Given Name</td><td>partner</td><td>partner</td></tr><tr><td>Surname</td><td>1</td><td>2</td></tr><tr><td>Partner Role</td><td>Is a consumer of data - Initiates a connection</td><td>Is a producer of data</td></tr><tr><td>Use SSH</td><td>Yes</td><td>Yes</td></tr><tr><td>Use Authorized User Key</td><td>No</td><td>No</td></tr><tr><td>PGP Settings</td><td>- No - No</td><td>- No - No</td></tr></tbody></table><p>Associate the partners with Group1. Select Participants &gt; Groups &gt; Add Partner. Select the partners and the group, and click Execute</p><p>Log out and log back into the <code>filegateway</code> as <code>fg_architect</code></p><p>Select Routes &gt; Templates &gt; Create to create a routing channel template with the following values:</p><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/260bc4f3-f735-48bf-8f93-af875861e416" alt="Template_Type.png|300" class="img_ev3q"></td><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/f513633a-f09d-4e37-a59a-9688e128a84f" alt="Template_Special_Characters.png|300" class="img_ev3q"></td></tr><tr><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/0b40b765-bf0b-4ce7-851f-4014416bbe0d" alt="Template_Groups.png|300" class="img_ev3q"></td><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/18c24d5d-ea91-4ac4-ba97-061bbd8f13e9" alt="Template_Provisioning_Facts.png|300" class="img_ev3q"></td></tr><tr><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/66378f70-9226-4789-80fb-73ec8de62c5f" alt="Template_Producer_File_Structure.png|300" class="img_ev3q"></td><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/49d355aa-03a2-456a-9cde-260602bc8c77" alt="Template_Consumer_File_Structure_add.png|300" class="img_ev3q"></td></tr><tr><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/5acfa848-027d-4ec7-95a3-c01cd38cf2bf" alt="Template_Consumer_File_Structure_format.png|300" class="img_ev3q"></td><td align="left"><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/e41e146b-8f13-4266-a692-01ac0768d467" alt="Template_Consumer_File_Structure_Save.png|300" class="img_ev3q"></td></tr></tbody></table><p>Save the template</p><p>Log out and log back into <code>filegateway</code> as <code>fg_provisioner</code></p><p>Create a routing channel with the following values:</p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td>Routing Channel Template</td><td>FirstStatic</td></tr><tr><td>Producer</td><td>Partner2</td></tr><tr><td>Consumer</td><td>Partner1</td></tr><tr><td>User ID</td><td>User1</td></tr></tbody></table><p>Log out of the UI and log in to the <code>myFileGateway</code> ui as <code>partner2</code>. You will probably need to change the password on first login.</p><p><a href="https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/myfilegateway" target="_blank" rel="noopener noreferrer">https://k8s-ingressn-ingressn-f9d3dcbc72-69d548b3e1e33f06.elb.us-east-1.amazonaws.com/myfilegateway</a></p><p>Upload a text file to the <code>/</code> mailbox and then log out.</p><p>Log in to <code>myfilegateway</code> as <code>partner1</code>. You will probably need to change the password on first login.</p><p>Click the <code>Download File</code> tab and see if the file is there. Since Partner1 is the consumer and Partner2 is the sender, the file should show up there.</p><p>Click on the file and download. Verify the file is downloaded and matches the naming convention we set.</p><p>Log out and log back in to <code>filegateway</code> as <code>fg_operator</code>. If the default <code>password</code> password does not work for him, you might need to log back into the dashboard as <code>fg_sysadmin</code> and manually set <code>fg_operator</code>&#x27;s password. Then you will be required to change it when you log in to the <code>filegateway</code></p><p>Search for the file that was uploaded. We called it <code>readme.txt</code> in this example.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/49489c00-e2f6-411f-9673-9f63226ef131" alt="File_search.png|300" class="img_ev3q"></p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/86314ce6-4907-4ae1-a94b-ce18e03f9f44" alt="File_search2.png|300" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sftp-access">SFTP Access<a href="#sftp-access" class="hash-link" aria-label="Direct link to SFTP Access" title="Direct link to SFTP Access">​</a></h3><p>In order to enable the SFTP Server Adapter, we first must create a host key.</p><p>Log into the <code>dashboard</code> url for B2Bi and select:</p><p><strong>Deployment-&gt;SSH Host Indentity Key</strong></p><p>Select the <strong>Go</strong> button next to New Host Identity key</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/b56c7114-5beb-4426-926e-2a1808ef3edb" alt="sfg-sftp-server-adapter-step01.png|300" class="img_ev3q"></p><p>Set the hostname to something that matches. In our example we set it to <code>sterlingb2bi</code> and then set the key length to 2048.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/7e71dfce-3241-4125-8f51-a9f1ed94e90f" alt="sfg-sftp-server-adapter-step02.png|300" class="img_ev3q"></p><p>Under <strong>Deployment-&gt;Services-&gt;Configuration</strong> Create the new service.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/243cebad-f948-4bb2-8672-6393f90f87fe" alt="sfg-sftp-server-adapter-step03.png|300" class="img_ev3q"></p><p>Select <code>SFTP Server Adapter 2.0</code> under the Service Type.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/bb6ca076-7c3e-48d5-8e39-5898f0255280" alt="sfg-sftp-server-adapter-step04.png|300" class="img_ev3q"></p><p>Under <code>Services Configuration</code>, let&#x27;s name this <code>SFTP Server Inbound</code> and also set that as the description. While B2BI has the capability of scaling the service to live across multiple pods, for now we are going to have it just live on our AC service pod.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/40abfb52-fb37-4de5-bde5-8f0ca664e1ef" alt="sfg-sftp-server-adapter-step05.png|300" class="img_ev3q"></p><p>Let&#x27;s configure our Services Configuration for SFTP Server Inbound with the following values. Our <code>Host Identity Key</code> will be pre-populated with the host key we already created.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/e0c21c1d-7384-4a5f-b238-af51f3889d3a" alt="sfg-sftp-server-adapter-step06.png|300" class="img_ev3q"></p><p>Now let&#x27;s set our document storage. For testing purposes we selected the Database to be our storage location where the files will be stored as blobs. Going forward this might not be the ideal location, but it is suitable for testing.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/35ba645a-aef0-4d03-a6f2-97dabaf7e89c" alt="sfg-sftp-server-adapter-step07.png|300" class="img_ev3q"></p><p>Next let&#x27;s configure our allowed users. This can be set to match a group, but for our purposes, we will use the two partner ids we created above.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/5e11b2c0-17f6-4e74-a2c3-fdd7ecb615f2" alt="sfg-sftp-server-adapter-step08.png|300" class="img_ev3q"></p><p>Our final services configuration should look similar to below. Make sure to check <code>Enable Service for Business Processes</code> as this will actually start the service. Also important to note that the listen port for the service will be <code>50039</code>.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/aca6e922-c6cc-4dc9-855c-9b81329596bd" alt="sfg-sftp-server-adapter-step09.png|300" class="img_ev3q"></p><p>Let&#x27;s verify the SFTP Adapter Service came up.</p><p>Under <strong>Services-&gt;Configuration</strong> search for <code>SFTP Inbound</code> as that&#x27;s what we called this service adapter.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/1272cbe7-93a2-426e-b6fe-0f7dddb06425" alt="sfg-sftp-server-adapter-step10.png|300" class="img_ev3q"></p><p>Under the <code>Select Node</code> dropdown, set it to <code>node1AC1</code> as that&#x27;s where we hosted this adapter service.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/5a450a3e-9b71-4739-b8dc-b460748c9889" alt="sfg-sftp-server-adapter-step11.png|300" class="img_ev3q"></p><p>You should see under Advanced Stats that the service in running and enabled. Clicking the exclaimation point next to <code>Enabled</code> will show you the service log.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/17ae7acc-d868-40a7-8e34-73d47daf37c9" alt="sfg-sftp-server-adapter-step12.png|300" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-configuration-to-allow-inbound-access">Cluster configuration to allow inbound access<a href="#cluster-configuration-to-allow-inbound-access" class="hash-link" aria-label="Direct link to Cluster configuration to allow inbound access" title="Direct link to Cluster configuration to allow inbound access">​</a></h3><p>So because we enabled the adapter to the AC node, we would need to add the extra ports to the overrides yaml for that service. </p><p>We are also listening to port 50039</p><p>So we update our AC overrides with the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">ac:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  replicaCount: 1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  env:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    jvmOptions:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    #Refer to global env.extraEnvs for sample values</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    extraEnvs: []</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  frontendService:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    type: ClusterIP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      http: </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        name: http</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        port: 35004</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        targetPort: http</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        nodePort: 30004</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    extraPorts:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      - name: sftp-frontend</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        port: 50039</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        targetPort: 50039</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        nodePort: 50039</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    loadBalancerIP:  </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    annotations: {}  </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  backendService:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    type: LoadBalancer</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      - name: adapter-1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        port: 30401</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        targetPort: 30401</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        nodePort: 30401</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      - name: sftp-backend</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        port: 50039</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        targetPort: 50039</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        nodePort: 50039</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    portRanges:</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      - name: adapters</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        portRange: 30501-30510</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        targetPortRange: 30501-30510</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        nodePortRange: 30501-30510</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    loadBalancerIP:  </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    annotations: {} </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s run a helm upgrade after updating our overrides:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">helm upgrade sterling-b2bi --debug -f overrides/sterling-b2bi-values.yaml ibm-b2bi-prod --timeout 3600s --namespace sterling</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When that is complete, retrieve the loadbalancer address with the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">kubectl get service sterling-b2bi-b2bi-ac-backend-svc -o jsonpath=&quot;{..hostname}&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">a3185b1737b284bcea6584859ea689e3-2046710660.us-east-1.elb.amazonaws.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that SFTP works from cmdline with the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">sftp -P 50039 partner2@a3185b1737b284bcea6584859ea689e3-2046710660.us-east-1.elb.amazonaws.com</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">The authenticity of host &#x27;[a3185b1737b284bcea6584859ea689e3-2046710660.us-east-1.elb.amazonaws.com]:50039 ([3.214.94.81]:50039)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">RSA key fingerprint is SHA256:fVTB9EihSrd651+zvl2RvzjuhZX11iwQaxNwBgDyvT4.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">This key is not known by any other names</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Warning: Permanently added &#x27;[a3185b1737b284bcea6584859ea689e3-2046710660.us-east-1.elb.amazonaws.com]:50039&#x27; (RSA) to the list of known hosts.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">SSH Server supporting SFTP and SCP</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">partner2@a3185b1737b284bcea6584859ea689e3-2046710660.us-east-1.elb.amazonaws.com&#x27;s password: </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Connected to a3185b1737b284bcea6584859ea689e3-2046710660.us-east-1.elb.amazonaws.com.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">sftp&gt;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We should now be able to put files here and observe their routing in the filegateway</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>You may need to update the health check ports in AWS EC2 for the loadbalancer to point to port <code>50039</code> or the nodePort as this will otherwise not allow traffic in.</p><p>If you run into any helm error when adding the extra ports definitions that has &quot;doesn&#x27;t match $setElementOrder list&quot; in the output, it&#x27;s possible this is a helm related bug. Re-run the &quot;helm upgrade&quot; with &quot;--force&quot;</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-a-sterling-connectdirect-server-adapter">Configuring a Sterling Connect:Direct Server Adapter<a href="#configuring-a-sterling-connectdirect-server-adapter" class="hash-link" aria-label="Direct link to Configuring a Sterling Connect:Direct Server Adapter" title="Direct link to Configuring a Sterling Connect:Direct Server Adapter">​</a></h3><p>The Connect:Direct server adapter receives and processes requests from remote Connect:Direct nodes. Files are copied to and from a mailbox or a business process to and from Connect:Direct nodes.</p><p>However, before we configure the Connect:Direct Server Adapter, there are other components that need to be configured. We must first create a Connect:Direct node and a Connect:Direct Netmap. Then using a Connect:Direct Cross-Reference, we will associate the node with the Netmap.</p><p>To begin, log into the Sterling B2Bi Admin console. Then from the Administration Menu on the left hand side, navigate to Deployment -&gt; Adapter Utilities -&gt; Sterling Connect:Direct -&gt; Nodes. In the box named create, you should see &quot;New Node&quot;. Click the &quot;Go!&quot; button on the right side of the box.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/755a223f-21e7-4181-8ec6-66bbc42b3d2d" alt="Connect Direct Node Location.png" class="img_ev3q"></p><p>On the next page, enter the values for your node. We will need to set:</p><ul><li>Sterling Connect:Direct Server Node Name - The node name for the Sterling Connect:Direct server.</li><li>Sterling Connect:Direct Server Host - The host name or IP address for the Sterling Connect:Direct server.</li><li>Sterling Connect:Direct Server Port - The host port number for the Sterling Connect:Direct server.</li><li>Max locally initiated (pnode) sessions allowed: Set to 10</li><li>Max remotely initiated (snode) sessions allowed: Set to 10</li><li>Leave the remaining fields/options blank or with their default value. </li></ul><p>At the bottom of the page select &quot;next&quot;. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/ffdbe66a-a137-4c66-a387-2f4d0cb7a499" alt="Connect Direct Node Settings.png" class="img_ev3q"></p><p>The following page will then display all your setting choices for a final review. If everything was correctly entered select &quot;Finish&quot; at the bottom.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/5683a817-4176-4244-a5b8-93d065a85ce1" alt="Connect Direct Node Confirmation.png" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Blue fields are always mandatory and can not be left blank. </p></div></div><p>Now lets move on and create a Netmap. From the Administration Menu on the left hand side, navigate to Deployment -&gt; Adapter Utilities -&gt; Sterling Connect:Direct -&gt; Netmaps. In the box named create, you should see &quot;New Netmap&quot;. Click the &quot;Go!&quot; button on the right side of the box.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/df5438c2-9680-42d8-9d6f-4ea4220687e8" alt="Connect Direct Netmap Location.png" class="img_ev3q"></p><p>On the next page, enter the values for your Netmap. We will need to set:</p><ul><li>Netmap Name - The Sterling Connect:Direct netmap name.</li><li>Netmap Description - Enter a description of your Netmap</li></ul><p>At the bottom of the page select &quot;next&quot;. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/7a845fb5-a47e-4d78-a036-2380d6baaa98" alt="Connect Direct Netmap Settings.png" class="img_ev3q"></p><p>The following page will then display all your setting choices for a final review. If everything was correctly entered select &quot;Finish&quot; at the bottom.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/a4be4512-7253-47c7-92a6-ca7758851840" alt="Connect Direct Netmap Confirmation.png" class="img_ev3q"></p><p>Now lets add our node to the Netmap using Connect:Direct Cross-Reference. From the Administration Menu on the left hand side, navigate to Deployment -&gt; Adapter Utilities -&gt; Sterling Connect:Direct -&gt; Netmap X-REF. In the box named &quot;Create or Modify&quot;, you should see &quot;Netmap Cross Reference&quot;. Click the &quot;Go!&quot; button on the right side of the box.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/c3e2c1ac-e1ae-457e-94fc-f8561e396498" alt="Connect Direct X-REF Location.png" class="img_ev3q"></p><p>The next page will ask you to select a Netmap. The Netmap we just created should already appear in the drop down box. Verify the Netmap then select &quot;next&quot; at the bottom.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/ec16d171-0226-4b4d-96f5-7ba28b7a2f4d" alt="Connect Direct X-REF Setting-1.png" class="img_ev3q"></p><p>On this next page &quot;Add Cross References&quot;, select the green plus next to &quot;New Node&quot;. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/25ecba57-f450-4118-991f-c00df0119163" alt="Connect Direct X-REF Setting-2.png" class="img_ev3q"></p><p>A pop-up window named &quot;Add New Node&quot; should appear. This will ask you to select the node you want to add to the Netmap. The node we created should appear in the box. Select it and select &quot;save&quot; at the bottom. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/ae98dea7-4529-44d8-8015-b988becba28a" alt="Connect Direct X-REF Setting-3.png" class="img_ev3q"></p><p>The node we selected should now appear in the list of nodes. At the bottom of the page select &quot;next&quot;. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/4463daf3-4787-463c-850d-a0c84761a2b9" alt="Connect Direct X-REF Setting-4.png" class="img_ev3q"></p><p>The following page will then display all your setting choices for a final review. If everything was correctly entered select &quot;Finish&quot; at the bottom.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/431677ac-07ee-41b2-b63d-68f685c19ad2" alt="Connect Direct X-REF Confirmation.png" class="img_ev3q"></p><p>Now finally, lets move on to creating a Sterling Connect:Direct Server Adapter. From the Administration Menu on the left hand side, navigate to Deployment -&gt; Services -&gt; Configuration. In the box named &quot;Create&quot;, you should see &quot;New Service&quot;. Click the &quot;Go!&quot; button on the right side of the box.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/e6d1573a-01f1-4a8e-984c-6617fb33be6c" alt="Connect Direct Adapter Location.png" class="img_ev3q"></p><p>The next screen will prompt you for which service type to configure. In the box next to &quot;Service Type&quot; enter &quot;Sterling Connect:Direct Server Adapter&quot; and then select &quot;next&quot; at the bottom. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/463b1f28-0741-4556-98ab-df0b6f71b2ae" alt="Connect Direct Adapter Setting-1.png" class="img_ev3q"></p><p>The next page will ask you to name the adapter and give a description. Fill out these fields and leave everything else default. Then select &quot;next&quot; at the bottom.</p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/a8822973-ef8e-4e66-95dc-3704da63033b" alt="Connect Direct Adapter Setting-2.png" class="img_ev3q"></p><p>The next page will ask you to configure general settings for the adapter. On this page we only need to enter a value for &quot;Sterling Connect:Direct Server Node Name&quot;. Generally, you will use the same name that you used for the adapter name. Enter that value in the box. Leave the rest of the settings with the default values and click &quot;next&quot; at the bottom. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/ff051835-d180-41ba-bb7d-4ba1056818d3" alt="Connect Direct Adapter Setting-3.png" class="img_ev3q"></p><p>Keep selecting &quot;next&quot; at the bottom leaving all values default until you get to the screen that references Netmap.</p><p>You should see an option named &quot;Sterling Connect:Direct Netmap Name&quot; followed by a drop down box. Within the drop down box, you should see the Netmap we created earlier. Verify the value then select &quot;next&quot; at the bottom. </p><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/408dbd6b-9dda-43cd-bcbc-5115a9301055" alt="Connect Direct Adapter Setting-4.png" class="img_ev3q"></p><p>The following page will then display all your setting choices for a final review. If everything was correctly entered select &quot;Finish&quot; at the bottom. And with that you have configured your Sterling Connect:Direct Server Adapter. If you need more information on the specific settings and options, please reference the following:</p><ul><li>Connect:Direct Node Settings: <a href="https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-sterling-connectdirect-nodes" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-sterling-connectdirect-nodes</a></li><li>Connect:Direct Netmap Settings: <a href="https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-sterling-connectdirect-netmaps" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-sterling-connectdirect-netmaps</a></li><li>Direct:Connect Netmap Cross-Reference Settings: <a href="https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-connectdirect-netmap-cross-reference" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-connectdirect-netmap-cross-reference</a></li><li>Connect:Direct Server Adapter Settings: <a href="https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-connectdirect-netmap-cross-reference" target="_blank" rel="noopener noreferrer">https://www.ibm.com/docs/en/b2b-integrator/5.2?topic=entry-creating-connectdirect-netmap-cross-reference</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sterling-file-gateway---access-multiple-kms-encrypted-s3-buckets-across-accounts">Sterling File Gateway - Access Multiple KMS Encrypted S3 Buckets Across Accounts<a href="#sterling-file-gateway---access-multiple-kms-encrypted-s3-buckets-across-accounts" class="hash-link" aria-label="Direct link to Sterling File Gateway - Access Multiple KMS Encrypted S3 Buckets Across Accounts" title="Direct link to Sterling File Gateway - Access Multiple KMS Encrypted S3 Buckets Across Accounts">​</a></h2><p>There may be situations where B2Bi needs to access multiple s3 buckets and these buckets may also reside within different AWS accounts. This guide will outline the process of creating, updating, and setting up IAM roles, policies, and resource-based policies. Then using these permissions to allow Sterling B2Bi running on EKS to interact with multiple s3 buckets that are residing in different AWS accounts. This guide assumes the prerequisites of having an OIDC provider in the EKS cluster and a service account that is attached to the pod B2Bi is running on. You also need CLI programmatic access to the EKS cluster and the AWS accounts that the EKS, S3 buckets, and KMS keys reside in. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-overview">Solution Overview<a href="#solution-overview" class="hash-link" aria-label="Direct link to Solution Overview" title="Direct link to Solution Overview">​</a></h3><p><img loading="lazy" src="https://zenhub.ibm.com/images/6442f46ac0371b5acaba3fc4/bdea7150-ce52-4960-ae89-c6af17dcd38d" alt="s3 multiple diagram.jpg" class="img_ev3q"></p><p>This diagram outlines the general solution of B2Bi accessing KMS encrypted s3 buckets that are within different AWS accounts. B2Bi is running on a pod within an EKS cluster. We use an IAM role and assign it to the service account attached the B2Bi pod. This is known as IAM Roles for Service Accounts (IRSA). In this example the role is within the same account that the EKS cluster is in. However, this role can be setup in any AWS account. Now that our B2Bi pod using a service account is associated with an AWS IAM role, we can now begin to assign permissions to that role. Because of the way IAM permissions work across accounts, we will need to add permissions to the role and we will also need to add a resource-based policy that allows the IAM role to use the bucket-key pair. Keep in mind that KMS keys can be used on multiple buckets. So, while you need to modify the resource-based policy for every S3 bucket since they are unique, you may have to modify a lesser number of KMS key resource-based policies since they can be shared across buckets. So in total, we will need to add policies to the iam role, the bucket, and the kms key. This will allow B2Bi to access KMS encrypted S3 Buckets in different accounts. </p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Two things to note. The first is this solution does not work with AWS Managed Keys. As of writing, AWS Managed Keys resource-based policies can not be altered and only principles from the same account the AWS Managed Key was created in has access to it. Meaning principles from other accounts can not access the key. Second, this solution is for accessing S3 KMS in different accounts. If the EKS cluster and KMS S3 buckets are all in the same account, you can still follow this guide. However, instead of using resource-based policies, you can assign policies directly to the IAM role since you don&#x27;t have to access resources across different accounts. </p></div></div><p>This document will walk through the following steps:</p><ol><li>Modify ~/.aws/credentials file to work with multiple AWS accounts</li><li>Link EKS OIDC identity provider to AWS account</li><li>Create an IAM role with trust relationship</li><li>Add policies and permissions to IAM role </li><li>Attach IAM Role to Service Account</li><li>Modify resource-based policies for S3 buckets and KMS keys.</li></ol><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Steps 2-5 will be done within the same AWS account.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modify-awscredentials-file">Modify ~/.aws/credentials file<a href="#modify-awscredentials-file" class="hash-link" aria-label="Direct link to Modify ~/.aws/credentials file" title="Direct link to Modify ~/.aws/credentials file">​</a></h3><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The steps mentioned in this section are intended to configure the AWS CLI for multiple user profiles within different AWS accounts. They are not directly part of the KMS S3 cross account solution. This will simply allow you to run commands in different accounts. If you intend to use the AWS Console or already have your AWS CLI configured, you can skip this step. </p></div></div><p>Since we will be working with multiple AWS accounts, we will need to modify the AWS CLI credentials file to setup multiple users. This process is pretty straightforward:</p><p><code>vim ~/.aws/credentials</code> or use a text editor of your choice to modify the credentials file. </p><p>Once in the file, you should see this structure:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">[default]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_access_key_id = XXXXXXXXXXXXX</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_secret_access_key = **********************************</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To add more users, simply follow the same structure and add the AWS users you want to the credentials file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">[user1]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_access_key_id = XXXXXXXXXXXXX</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_secret_access_key = **********************************</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">[user2]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_access_key_id = XXXXXXXXXXXXX</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_secret_access_key = **********************************</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">[user3]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_access_key_id = XXXXXXXXXXXXX</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws_secret_access_key = **********************************</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Each user will have an unique aws_access_key_id and aws_secret_access_key. Above this you see user1, user2, user3. These are profiles that we can set and we are assigning those credentials to those profiles. The profile names can be whatever you want them to be. This will be used in the AWS CLI to specify which account the command will be run in:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3 ls --profile user1 # runs command in account 1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3 ls --profile user2 # runs command in account 2</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">aws s3 ls --profile user3 # runs command in account 3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This assumes users from different AWS accounts. Its possible to have AWS users from the same AWS account. For simplicity, this document assumes you have a user from each AWS account with the correct permissions.</p></div></div><p>While interacting with the ~/.aws/credentials file and making adjustments to profiles, it&#x27;s important to note that this action could potentially disrupt your kubectl functionality. To rectify this situation, you can utilize the following command:</p><p><code>aws eks update-kubeconfig --name CLUSTER_NAME --region AWS_REGION --profile PROFILE_NAME</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-eks-oidc-identity-provider-to-aws-account">Link EKS OIDC Identity Provider to AWS Account<a href="#link-eks-oidc-identity-provider-to-aws-account" class="hash-link" aria-label="Direct link to Link EKS OIDC Identity Provider to AWS Account" title="Direct link to Link EKS OIDC Identity Provider to AWS Account">​</a></h3><p>IAM identity providers enable you to manage external identities outside of AWS, and IAM OIDC identity providers define external identity provider services that follow the OpenID Connect (OIDC) standard. In our case, we&#x27;re utilizing an OIDC identity provider within our EKS cluster. To ensure AWS can authenticate requests from this provider, we must integrate it into our AWS Account. So to start, pick the AWS account you want to setup your IAM role and identity provider. Once you have decided on an account, lets link the identity provider.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Remember to put <code>--profile &lt;YOUR_PROFILE&gt;</code> at end of each command to specify what AWS account to run the command in.</p></div></div><p>First thing we need is the OIDC identity provider URL associated with the OIDC identity provider in the EKS cluster. We can get the URL by running the following command:</p><p><code>aws eks describe-cluster --name CLUSTER_NAME --query &quot;cluster.identity.oidc.issuer&quot; --region AWS_REGION --profile YOUR_PROFILE</code></p><p>If you need a reminder of the name of the cluster name, use the following command:</p><p><code>aws eks list-clusters --region AWS_REGION --profile YOUR_PROFILE</code></p><p>Now using the OIDC identity provider URL we got, lets modify the url. We are going to add <code>/.well-known/openid-configuration</code> to the end of the url. Your url should look similar in structure. </p><p><a href="https://oidc.eks.us-east-1.amazonaws.com/id/example/.well-known/openid-configuration" target="_blank" rel="noopener noreferrer">https://oidc.eks.us-east-1.amazonaws.com/id/example/.well-known/openid-configuration</a></p><p>Now open a browser and go to that URL. You should see JSON output similar to this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;issuer&quot;: &quot;https://oidc.eks.us-east-1.amazonaws.com/id/example&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;jwks_uri&quot;: &quot;https://oidc.eks.us-east-1.amazonaws.com/id/example/keys&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;authorization_endpoint&quot;: &quot;urn:kubernetes:programmatic_authorization&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;response_types_supported&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        &quot;id_token&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;subject_types_supported&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        &quot;public&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;claims_supported&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        &quot;sub&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        &quot;iss&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;id_token_signing_alg_values_supported&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        &quot;RS256&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We are looking for the &quot;jwks_uri&quot;. The &quot;jwks_uri&quot; should have a url as its key value. We need the &quot;jwks_uri&quot; url for the next step but we only need part of it. Remove the https:// and the /paths following the URL. Here is an example:</p><p>&quot;jwks_uri&quot;: &quot;<a href="https://oidc.eks.us-east-1.amazonaws.com/id/example/keys%22" target="_blank" rel="noopener noreferrer">https://oidc.eks.us-east-1.amazonaws.com/id/example/keys&quot;</a></p><p><a href="https://oidc.eks.us-east-1.amazonaws.com/id/example/keys" target="_blank" rel="noopener noreferrer">https://oidc.eks.us-east-1.amazonaws.com/id/example/keys</a></p><s>https://</s>oidc.eks.us-east-1.amazonaws.com<s>/id/example/keys</s><p>You are left with:</p><p>oidc.eks.us-east-1.amazonaws.com</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Your URL and JSON values may be different. This is just an example.</p></div></div><p>Next we need to extract the thumbprint from this URL. The Identity Provider thumbprint, also known as the OIDC provider thumbprint, is a security measure used to establish trust between the Identity Provider and AWS services. When you configure an OIDC identity provider in AWS IAM, you need to supply the thumbprint for the top intermediate certificate authority that signed the certificate. Once we have a trusted thumbprint, AWS can establish trust with the EKS OIDC identity provider. To get this thumbprint we will use OpenSSL. If you don&#x27;t have OpenSSL currently installed you can run the following command:</p><p><code>brew install openssl</code></p><p>We can check its installation by running:</p><p><code>openssl version</code></p><p>Now using OpenSSL, we can obtain the certificate from the certificate authority that signed the URL. Using the URL with the removed  https:// and trailing /paths, run the following command:</p><p><code>openssl s_client -servername YOUR_URL -showcerts -connect YOUR_URL:443</code></p><p>You should see a chain of  &quot;-----BEGIN CERTIFICATE-----&quot; and &quot;-----END CERTIFICATE-----&quot; </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">MIIF7DCCBNSgAwIBAgIQByOkjeOvl//8xMrhlZkruzANBgkqhkiG9w0BAQsFADA8</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRwwGgYDVQQDExNBbWF6b24g</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">UlNBIDIwNDggTTAyMB4XDTIzMDUxMzAwMDAwMFoXDTI0MDYxMDIzNTk1OVowKzEp</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">...example...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">ZUxtmBX91AEQ1ccU+Odj2ILrWdSs28J82ODoPlkJ6OqIYo+kEXrUwy8SM2N9iFJw</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">HgZNOwzPQ2Ox/ozlRh6/6OUgYZ84j343BoDnNbTQijLBe6HL4pVw4nPKWrUQnTot</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">xMymAcBknnb4X4TcmEoJ0CrB1H6FKfe8yASCLjwSC72Os9ADyADMZqTUSOH1V8Vh</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">R3Zv4DlLItu8BHaE59teueLM9AW1PBFMci5JiYrgLEM=</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> 1 s:/C=US/O=Amazon/CN=Amazon RSA 2048 M02</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   i:/C=US/O=Amazon/CN=Amazon Root CA 1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">MIIEXjCCA0agAwIBAgITB3MSSkvL1E7HtTvq8ZSELToPoTANBgkqhkiG9w0BAQsF</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">ADA5MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRkwFwYDVQQDExBBbWF6</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">b24gUm9vdCBDQSAxMB4XDTIyMDgyMzIyMjUzMFoXDTMwMDgyMzIyMjUzMFowPDEL</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">...example...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">JqIRZhMbgAfp7O7FUwFIb7UIspogZSKxPIWJpxiPo3TcBambbVtQOcNRWz5qCQdD</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">slI2yayq0n2TXoHyNCLEH8rpsJRVILFsg0jc7BaFrMnF462+ajSehgj12IidNeRN</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">4zl+EoNaWdpnWndvSpAEkq2P</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"> 2 s:/C=US/O=Amazon/CN=Amazon Root CA 1</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   i:/C=US/ST=Arizona/L=Scottsdale/O=Starfield Technologies, Inc./CN=Starfield Services Root Certificate Authority - G2</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">MIIEkjCCA3qgAwIBAgITBn+USionzfP6wq4rAfkI7rnExjANBgkqhkiG9w0BAQsF</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">ADCBmDELMAkGA1UEBhMCVVMxEDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNj</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">b3R0c2RhbGUxJTAjBgNVBAoTHFN0YXJmaWVsZCBUZWNobm9sb2dpZXMsIEluYy4x</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">...example...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">eyKdpwAJfqxGF4PcnCZXmTA5YpaP7dreqsXMGz7KQ2hsVxa81Q4gLv7/wmpdLqBK</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">bRRYh5TmOTFffHPLkIhqhBGWJ6bt2YFGpn6jcgAKUj6DiAdjd4lpFw85hdKrCEVN</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">0FE6/V1dN2RMfjCyVSRCnTawXZwXgWHxyvkQAiSr6w10kY17RSlQOYiypok1JR4U</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">akcjMS9cmvqtmg5iUaQqqcT5NJ0hGA==</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">-----END CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Scroll to the very top of this chain and take the very first certificate and save it to a file. Name the file <code>certificate.crt</code>.</p><p>Using the example certificate chain above and taking the top most certificate, our <code>certificate.crt</code> should look similar to this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">-----BEGIN CERTIFICATE-----</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">MIIF7DCCBNSgAwIBAgIQByOkjeOvl//8xMrhlZkruzANBgkqhkiG9w0BAQsFADA8</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">MQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRwwGgYDVQQDExNBbWF6b24g</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">UlNBIDIwNDggTTAyMB4XDTIzMDUxMzAwMDAwMFoXDTI0MDYxMDIzNTk1OVowKzEp</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">...example...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">ZUxtmBX91AEQ1ccU+Odj2ILrWdSs28J82ODoPlkJ6OqIYo+kEXrUwy8SM2N9iFJw</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">HgZNOwzPQ2Ox/ozlRh6/6OUgYZ84j343BoDnNbTQijLBe6HL4pVw4nPKWrUQnTot</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">xMymAcBknnb4X4TcmEoJ0CrB1H6FKfe8yASCLjwSC72Os9ADyADMZqTUSOH1V8Vh</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">R3Zv4DlLItu8BHaE59teueLM9AW1PBFMci5JiYrgLEM=</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">-----END CERTIFICATE-----</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can extract the thumbprint using this <code>certificate.crt</code> file. Extracting the thumbprint will give us a SHA1 Fingerprint. However, we need to remove the colons from the fingerprint for it to be usable. We can do all this in one command:</p><p><code>openssl x509 -in certificate.crt -fingerprint -sha1 -noout | tr -d &#x27;:&#x27;</code></p><p>The output should be similar to this:</p><p><code>SHA1 Fingerprint=&lt;NUMBERS_LETTERS&gt;</code></p><p>Now that we have the finger print, we can finish setting up the identity provider in the AWS Account. Using the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">aws iam create-open-id-connect-provider --url OIDC_ISSUER_URL --thumbprint-list THUMBPRINT_LIST --client-id-list CLIENT_ID_LIST --region AWS_REGION --profile YOUR_PROFILE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>OIDC_ISSUER_URL: The full OIDC issuer URL obtained earlier through the command <code>aws eks describe-cluster --name CLUSTER_NAME --query &quot;cluster.identity.oidc.issuer&quot; --region AWS_REGION --profile YOUR_PROFILE</code></li><li>THUMBPRINT_LIST: The fingerprint we obtained in the previous steps</li><li>CLIENT_ID_LIST: A list of client IDs. For EKS, you can use &quot;sts.amazonaws.com&quot; as the client ID.</li></ul><p>We can check to see if the identity provider was setup in the AWS account by using the command:</p><p><code>aws iam list-open-id-connect-providers --profile YOUR_PROFILE</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-iam-role-with-trust-relationship">Create an IAM Role With Trust Relationship<a href="#create-an-iam-role-with-trust-relationship" class="hash-link" aria-label="Direct link to Create an IAM Role With Trust Relationship" title="Direct link to Create an IAM Role With Trust Relationship">​</a></h3><p>Now that we linked the OIDC Identity Provider from the EKS cluster to an AWS account, we can create a role that a service account within the EKS cluster can assume. In this document, we won&#x27;t go under the hood and discuss the intricacies of how a service account, OIDC Identity Provider, and AWS IAM interact and authenticate. Just know that B2Bi is running in a pod. That pod uses a service account as an identity and that service account is an authenticated user through the EKS OIDC Identity Provider. We linked the EKS OIDC Identity Provider to an AWS Account in the previous section and now that service account can assume a role in the AWS account. </p><p>Before we can create a role, we must create a trust policy. This trust policy essentially tells AWS which entities can use this role. In our case, it will be the EKS OIDC Identity Provider, since this is where the service account is coming from. </p><p>Using your editor of choice, create the following JSON document:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;Federated&quot;: &quot;arn:aws:iam::ACCOUNT_ID:oidc-provider/oidc.eks.AWS_REGION.amazonaws.com/id/OIDC_ID&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Action&quot;: &quot;sts:AssumeRoleWithWebIdentity&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Condition&quot;: {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;StringEquals&quot;: {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    &quot;oidc.eks.AWS_REGION.amazonaws.com/id/OIDC_ID:aud&quot;: &quot;sts.amazonaws.com&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This is a template. Replace with the values for your EKS cluster.</p></div></div><p>Now that we have a trust policy to our EKS OIDC Identity Provider, we can create an IAM Role and reference this trust policy during the role creation. Run the following command to create a role with a trust policy:</p><p><code>aws iam create-role --role-name YOUR_ROLE_NAME --assume-role-policy-document file://YOUR_TRUST_POLICY.json --profile YOUR_PROFILE</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-policies-and-permissions-to-iam-role">Add policies and permissions to IAM role<a href="#add-policies-and-permissions-to-iam-role" class="hash-link" aria-label="Direct link to Add policies and permissions to IAM role" title="Direct link to Add policies and permissions to IAM role">​</a></h3><p>Lets now add permissions to this role. By default, users and roles within AWS have no permissions. Remember the goal is to access KMS encrypted S3 buckets that are in different accounts. So we will need at minimum KMS and S3 permissions. Now there is a couple of ways of adding permissions to a role. You can do either an inline policy or attach a managed policy. With inline, the policy is built into the role and can&#x27;t be used on other entities. On the other hand, when you create and attach a managed policy, that policy exists outside of the role/entity. You can reuse this policy on multiple entities and altering this policy will alter the permissions for all entities that have this policy attached. We will cover both.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This section discusses inline policies and managed policies. You do not need to implement both. </p></div></div><p>To create any type of policy, we first need to create a policy document. So using the editor of your choice, create a JSON policy document. Here is an example document:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Action&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:GetObject&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:PutObject&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:DeleteObject&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:ListBucket&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:ListBucketMultipartUploads&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:GetBucketLocation&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:Encrypt&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:Decrypt&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:GenerateDataKey*&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:DescribeKey&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Resource&quot;: &quot;*&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This is an example policy. As you integrate policies into your environment, it is crucial to thoroughly assess your unique requirements and adhere to security compliance standards. Customize this policy to align with your specific needs and ensure it accurately reflects your security posture.</p></div></div><p>Now that we created a policy document with permissions for our role, to create an inline policy run the following command:</p><p><code>aws iam put-role-policy --role-name YOUR_ROLE_NAME --policy-name YOUR_POLICY_NAME --policy-document file://YOUR_POLICY.json --profile YOUR_PROFILE</code></p><p>To view an inline policy for a role, use the command:</p><p><code>aws iam get-role-policy --role-name ROLE_NAME --policy-name POLICY_NAME --profile YOUR_PROFILE</code></p><p>If you need a refresher on the name of the policy, you can view the policies attached to a role with the command:</p><p><code> aws iam list-role-policies --role-name YOUR_ROLE_NAME --query PolicyNames --output text --profile YOUR_PROFILE</code></p><p>If you need to edit the inline policy, you can rerun the <code>aws iam put-role-policy</code> we used earlier. This will overwrite the existing inline policy. </p><p>Now lets move on to a managed policy. When attaching a managed policy to a role, we can either use a preexisting policy or create a new policy. If using a preexisting policy, keep in mind that any changes made to that policy will affect all entities the policy is attached to. </p><p>To create an IAM managed policy, we will need the policy document we created earlier and we can use the following command. If using a preexisting policy, you can skip this step.</p><p><code>aws iam create-policy --policy-name POLICY_NAME --policy-document file://YOUR_POLICY.json --profile YOUR_PROFILE</code></p><p>We can view the policy we just created and other managed policies within the AWS account by using the following command:</p><p><code>aws iam list-policies --scope Local --profile YOUR_PROFILE</code></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>If you do not see the policy in the list, you may need to scroll down.</p></div></div><p>If you know the ARN for the policy, we can view a specific policy using the command:</p><p><code>aws iam get-policy --policy-arn POLICY_ARN --profile YOUR_PROFILE</code></p><p>If you need to edit an existing policy, you cannot directly modify a policy in place. Instead, you need to create a new version of the policy with the changes you want and then set that new version as the default version. To modify a managed policy, create a new version, and set that version to the default version, use the command:</p><p><code>aws iam create-policy-version --policy-arn POLICY_ARN --policy-document file://YOUR_POLICY.json --set-as-default --profile YOUR_PROFILE</code></p><p>We can see the different versions a managed policy has, use the command:</p><p><code>aws iam list-policy-versions --policy-arn POLICY_ARN --profile YOUR_PROFILE</code></p><p>The pervious command will only show you the versions not the permissions inside the version. To view the permissions in a version use the command:</p><p><code>aws iam get-policy-version --policy-arn POLICY_ARN --version-id VERSION_ID --profile YOUR_PROFILE</code></p><p>Lastly, to switch between versions, use the command:</p><p><code>aws iam set-default-policy-version --policy-arn POLICY_ARN --version-id VERSION --profile YOUR_PROFILE</code></p><p>Now that we have a managed policy configured, we can now attach that policy to the role we created earlier using the command:</p><p><code>aws iam attach-role-policy --role-name YOUR_ROLE_NAME --policy-arn YOUR_POLICY_ARN --profile YOUR_PROFILE</code></p><p>To view the policies attached to a role, use the command:</p><p><code>aws iam list-attached-role-policies --role-name YOUR_ROLE_NAME --profile YOUR_PROFILE</code></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Inline policies do not appear in this list.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="attach-iam-role-to-service-account">Attach IAM Role to Service Account<a href="#attach-iam-role-to-service-account" class="hash-link" aria-label="Direct link to Attach IAM Role to Service Account" title="Direct link to Attach IAM Role to Service Account">​</a></h3><p>Now that we have an IAM Role configured and have given it permissions, we now need to tell the service account connected to the B2Bi pod to use this role. To do so, we use an annotation on the service account. Use the following command to annotate the service account with the role:</p><p><code>kubectl annotate serviceaccount SERVICE_ACCOUNT_NAME eks.amazonaws.com/role-arn=ROLE_ARN --namespace MY_NAMESPACE</code></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>You may need to restart the B2Bi pod for this change to take effect.</p></div></div><p>If you want to alter the annotation, you can overwrite the current annotation by adding the <code>--overwrite</code> flag at the end and rerun the command. </p><p>To view and verify the annotation on the service account, you can use the command:</p><p><code>kubectl describe sa SERVICE_ACCOUNT_NAME</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-resource-based-policies-for-s3-buckets-and-kms-keys">Modifying resource-based policies for S3 buckets and KMS keys.<a href="#modifying-resource-based-policies-for-s3-buckets-and-kms-keys" class="hash-link" aria-label="Direct link to Modifying resource-based policies for S3 buckets and KMS keys." title="Direct link to Modifying resource-based policies for S3 buckets and KMS keys.">​</a></h3><p>In this section, we will be modifying the resource-based policy for an S3 bucket (bucket policy) and a KMS key (key policy). The buckets and keys should be in a different account than the role we created. Since we are dealing with different accounts, make sure to use the correct profile <code>--profile &lt;YOUR_PROFILE&gt;</code> for the account the bucket and key reside. </p><p>Lets begin with an S3 bucket. We can view the buckets in an AWS account using the following command: </p><p><code>aws s3 ls --profile YOUR_PROFILE</code></p><p>Once we find the bucket we want B2Bi to use, we can begin to modify the bucket policy. Before we modify the bucket policy, its possible that the bucket might already have a bucket policy attached. We can check using the following command:</p><p><code>aws s3api get-bucket-policy --bucket YOUR_BUCKET_NAME --profile YOUR_PROFILE</code></p><p>If there is a bucket policy attached, this command will output the policy. If there is no policy on the bucket, the output should say &quot;The bucket policy does not exist&quot;. If there is a policy attached to the bucket, we don&#x27;t want to throw away those permissions. They are probably giving needed permissions to some other entity. The next step is to create a bucket policy document. If there was a preexisting bucket policy we want to bring those permissions into the new bucket policy document. If the bucket did not have a preexisting policy, we don&#x27;t have to worry about bringing in those previous permissions. Using an editor of your choice, create a JSON bucket policy document. Here is an example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Sid&quot;: &quot;Allow-B2Bi-Role-S3-Access&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;AWS&quot;: &quot;YOUR_ROLE_ARN&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Action&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:GetObject&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:PutObject&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:DeleteObject&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:ListBucket&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:ListBucketMultipartUploads&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;s3:GetBucketLocation&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Resource&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;arn:aws:s3:::YOUR_BUCKET_NAME/*&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;arn:aws:s3:::YOUR_BUCKET_NAME&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This is an example policy and it doesn&#x27;t account for your specific preexisting permissions. Also, as you integrate policies into your environment, it is crucial to thoroughly assess your unique requirements and adhere to security compliance standards. Customize this policy to align with your specific needs and ensure it accurately reflects your security posture.</p></div></div><p>In the example bucket policy above, remember that B2Bi is using the role we created in the previous section to gain AWS access. Make sure to replace <code>YOUR_ROLE_ARN</code> in the principle of the bucket policy with the role associated with B2Bi.  </p><p>Now that we have a bucket policy document with the permissions we want to give. We can now attach that bucket policy to the s3 bucket with the command:</p><p><code>aws s3api put-bucket-policy --bucket YOUR_BUCKET_NAME --policy file://BUCKET_POLICY.json --profile YOUR_PROFILE</code></p><p>Using the <code>get-bucket-policy</code> we used earlier, we should now see our modified policy attached to the bucket. </p><p>Now that we have the s3 bucket configured with the correct permissions and policy, lets now modify the KMS key policy. Before we modify the key policy, we need to find what KMS key the bucket is using for encryption. To get this information, use the command:</p><p><code>aws s3api get-bucket-encryption --bucket BUCKET_NAME --profile YOUR_PROFILE</code></p><p>In the output of this command, we should see &quot;KMSMasterKeyID&quot; (Assuming this is an KMS encrypted S3 bucket). The value for &quot;KMSMasterKeyID&quot; should be a KMS key ARN. This is the key being used to encrypt this S3 bucket. </p><p>Now that we have the key that is being used to encrypt the S3 bucket. We can now start to modify the key policy. We will use almost all the same steps that we did when modifying the bucket policy. We need to create a JSON key policy document and again, we need to be cognizant of the preexisting key policy. Unlike the bucket policy, AWS automatically creates and attaches a basic key policy. We will need to bring those permissions into the new key policy document. To view the key policy, use the command:</p><p><code>aws kms get-key-policy --key-id KEY_ARN --policy-name default --output text --region AWS_REGION --profile YOUR_PROFILE</code></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><code>--policy-name</code> will always be set to the value <code>default</code></p></div></div><p>Now taking those preexisting permissions into account, create a JSON key policy document. Here is an example document:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Sid&quot;: &quot;EnableIAMUserPermissions&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;AWS&quot;: &quot;arn:aws:iam::ACCOUNT_ID_WHERE_KEY_WAS_CREATED:root&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Action&quot;: &quot;kms:*&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Resource&quot;: &quot;*&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Sid&quot;: &quot;Allow-B2Bi-Role-KMS-Access&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;AWS&quot;: &quot;YOUR_ROLE_ARN&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Action&quot;: [</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:Encrypt&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:Decrypt&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:GenerateDataKey*&quot;,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                &quot;kms:DescribeKey&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            &quot;Resource&quot;: &quot;*&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This is an example policy and it doesn&#x27;t account for your specific preexisting permissions. Also, as you integrate policies into your environment, it is crucial to thoroughly assess your unique requirements and adhere to security compliance standards. Customize this policy to align with your specific needs and ensure it accurately reflects your security posture.</p></div></div><p>Now that you have a bucket policy and key policy, the role and in turn B2Bi should have access to that bucket-key pair. You can repeat this process for other bucket-key pairs you need B2Bi to access. Try to retrieve and send files to the S3 bucket using B2Bi. If you are able to, you have successfully configured access to KMS encrypted S3 buckets across accounts.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/ibm-client-engineering/solution-sfg-aws/tree/main/packages/create-docusaurus/templates/shared/docs/3-Create/Integrate.md" target="_blank" rel="noreferrer noopener" class="ThemeClassNames.common.editThisPage editThisPage_U9Uk">Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/solution-sfg-aws/Create/solution-validate"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Validate</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#task-overview" class="table-of-contents__link toc-highlight">Task Overview</a></li><li><a href="#task-breakdown" class="table-of-contents__link toc-highlight">Task Breakdown</a><ul><li><a href="#creating-an-apiadmin-user" class="table-of-contents__link toc-highlight">Creating an <code>apiadmin</code> user</a></li></ul></li><li><a href="#uploading-required-jar-files-for-s3-access" class="table-of-contents__link toc-highlight">Uploading Required Jar files for S3 access</a><ul><li><a href="#downloading-latest-aws-sdk-zip-file" class="table-of-contents__link toc-highlight">Downloading latest AWS SDK zip file</a></li><li><a href="#propertyui-url" class="table-of-contents__link toc-highlight">PropertyUI url</a></li><li><a href="#upload-each-jar-file" class="table-of-contents__link toc-highlight">Upload each jar file</a></li></ul></li><li><a href="#configuring-communication-adapters" class="table-of-contents__link toc-highlight">Configuring communication adapters:</a><ul><li><a href="#sftp-access" class="table-of-contents__link toc-highlight">SFTP Access</a></li><li><a href="#cluster-configuration-to-allow-inbound-access" class="table-of-contents__link toc-highlight">Cluster configuration to allow inbound access</a></li><li><a href="#configuring-a-sterling-connectdirect-server-adapter" class="table-of-contents__link toc-highlight">Configuring a Sterling Connect:Direct Server Adapter</a></li></ul></li><li><a href="#sterling-file-gateway---access-multiple-kms-encrypted-s3-buckets-across-accounts" class="table-of-contents__link toc-highlight">Sterling File Gateway - Access Multiple KMS Encrypted S3 Buckets Across Accounts</a><ul><li><a href="#solution-overview" class="table-of-contents__link toc-highlight">Solution Overview</a></li><li><a href="#modify-awscredentials-file" class="table-of-contents__link toc-highlight">Modify ~/.aws/credentials file</a></li><li><a href="#link-eks-oidc-identity-provider-to-aws-account" class="table-of-contents__link toc-highlight">Link EKS OIDC Identity Provider to AWS Account</a></li><li><a href="#create-an-iam-role-with-trust-relationship" class="table-of-contents__link toc-highlight">Create an IAM Role With Trust Relationship</a></li><li><a href="#add-policies-and-permissions-to-iam-role" class="table-of-contents__link toc-highlight">Add policies and permissions to IAM role</a></li><li><a href="#attach-iam-role-to-service-account" class="table-of-contents__link toc-highlight">Attach IAM Role to Service Account</a></li><li><a href="#modifying-resource-based-policies-for-s3-buckets-and-kms-keys" class="table-of-contents__link toc-highlight">Modifying resource-based policies for S3 buckets and KMS keys.</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Explore</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.ibm.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM</a></li><li class="footer__item"><a href="https://www.ibm.com/client-engineering" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM Client Engineering - Open Solutions Library</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://ibm.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="https://upload.wikimedia.org/wikipedia/commons/5/51/IBM_logo.svg" alt="IBM Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" width="150" height="150"><img src="https://upload.wikimedia.org/wikipedia/commons/5/51/IBM_logo.svg" alt="IBM Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" width="150" height="150"></a></div></div></div></footer></div>
<script src="/solution-sfg-aws/assets/js/runtime~main.bb3352e2.js"></script>
<script src="/solution-sfg-aws/assets/js/main.8093d258.js"></script>
</body>
</html>